:{$PORT} {
    log {
        format json
    }

    rewrite {
        if {>X-API-Key} not {$API_KEY}
        to /forbidden
    }

    respond /forbidden 403

    reverse_proxy {
        dynamic a {
            name {$UPSTREAM_DOMAIN}
            port {$UPSTREAM_PORT}
            refresh 1s
            dial_timeout 30s
            versions ipv4 ipv6
        }
    }
}
